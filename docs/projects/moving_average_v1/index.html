<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Moving Average Strategy (v1)</title>

  <style>
    :root{
      --bg: #081425;          /* uniform dark blue background */
      --panel: rgba(255,255,255,0.06);
      --panel-2: rgba(255,255,255,0.04);
      --border: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --muted2: rgba(255,255,255,0.58);
      --shadow: 0 10px 35px rgba(0,0,0,0.35);
      --radius: 18px;
      --radius2: 14px;
      --maxw: 1200px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);  /* IMPORTANT: no gradients anywhere */
      color: var(--text);
      font-family: var(--font);
    }

    /* Hard override in case anything else adds gradients */
    body::before, body::after { content: none !important; }

    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 28px 18px 40px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 14px;
      color: var(--muted);
      font-size: 14px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 26px 26px 22px;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
    }

    h1{
      margin: 0 0 10px;
      font-size: 46px;
      letter-spacing: -0.6px;
      line-height: 1.05;
    }

    .subtitle{
      margin: 0;
      color: var(--muted);
      font-size: 20px;
      line-height: 1.45;
      max-width: 980px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 2fr;
      gap: 16px;
      align-items: start;
    }

    .card{
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card-inner{
      padding: 18px 18px 16px;
    }

    .card h2{
      margin: 0 0 10px;
      font-size: 28px;
      letter-spacing: -0.3px;
    }

    .body{
      color: var(--muted);
      font-size: 16px;
      line-height: 1.55;
      margin: 0;
    }

    /* Assumptions list: move bullets left */
    .assumptions{
      margin-top: 18px;
      border-top: 1px solid rgba(255,255,255,0.08);
      padding-top: 14px;
    }
    .assumptions h3{
      margin: 0 0 10px;
      font-size: 26px;
      color: var(--text);
    }
    .assumptions ul{
      margin: 0;
      padding-left: 16px; /* smaller than default => bullets left */
      color: var(--muted);
    }
    .assumptions li{
      margin: 8px 0;
      line-height: 1.45;
    }
    .assumptions strong{ color: var(--text); }

    .divider {
    border: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.10);
    margin: 18px 0;
    }

    .formulas li {
    line-height: 1.45;
    }

    .results-header{
      padding: 18px 18px 0;
    }
    .results-header h2{
      margin: 0 0 12px;
      font-size: 28px;
    }

    table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow: hidden;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.10);
    }

    thead th{
      text-align:left;
      font-weight: 650;
      color: rgba(255,255,255,0.86);
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      font-size: 16px;
    }

    tbody td{
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.80);
      font-size: 18px;
    }

    tbody tr:last-child td{
      border-bottom: none;
    }

    td.metric{
      color: rgba(255,255,255,0.90);
      font-weight: 650;
      width: 42%;
    }

    .note{
      margin: 14px 2px 0;
      color: var(--muted2);
      font-size: 16px;
    }

    .chart-card{
      margin-top: 16px;
    }
    .chart-inner{
      padding: 18px;
    }
    .chart-header h2{
      margin: 0 0 8px;
      font-size: 22px;
    }
    .chart-sub{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.4;
    }

    iframe{
      width: 100%;
      height: 760px;
      border: 0;
      border-radius: 16px;
      overflow: hidden;
      background: rgba(0,0,0,0.10);
    }

    @media (max-width: 900px){
      h1{ font-size: 38px; }
      .grid{ grid-template-columns: 1fr; }
      tbody td{ font-size: 16px; }
      td.metric{ width:auto; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <div>
        <a href="../../index.html">← Back to Projects</a>
        <span> / </span>
        <span>Moving Average v1</span>
      </div>
      <div class="pill">OPResearch <span style="opacity:.7;">•</span> v1</div>
    </div>

    <section class="hero">
      <h1>Moving Average Strategy (v1)</h1>
      <p class="subtitle">
        A weekly-rebalanced, rules-based strategy that ranks a fixed universe of large-cap U.S. equities using a trailing
        12-month signal and holds the top names. Results are shown versus an equal-weight benchmark of the same universe
        and the Nasdaq 100 (QQQ) as a broad market proxy.
      </p>
    </section>

    <section class="grid">
      <!-- LEFT: Overview + Assumptions -->
      <div class="card">
        <div class="card-inner">
          <h2>Overview</h2>
          <p class="body">
            The objective of this version is to establish a transparent baseline for systematic decision-making using only
            end-of-week price information. The strategy computes a trailing signal (12-month lookback), selects the strongest
            names within the universe, and rebalances weekly. All performance statistics are computed on aligned weekly
            observations (same start date across series) to ensure an apples-to-apples comparison.
          </p>

          <div class="assumptions">
            <h3>Assumptions</h3>
            <ul>
              <li><strong>Frequency:</strong> weekly rebalancing (end-of-week data)</li>
              <li><strong>Lookback:</strong> 12-month trailing window before first trade</li>
              <li><strong>Universe:</strong> fixed set of 10 large-cap U.S. equities</li>
              <li><strong>Benchmark:</strong> equal-weight basket of the same universe</li>
              <li><strong>Market proxy:</strong> Nasdaq 100 (QQQ)</li>
              <li><strong>Costs:</strong> not included in v1</li>
            </ul>
          </div>
        </div>
      </div>

<div class="assumptions formulas">
  <h3>Key Formulas</h3>

  <hr class="divider">

  <ul>
    <li>
      <strong>Total Return:</strong>
      (Final Portfolio Value / Initial Value - 1)
    </li>

    <li>
      <strong>Annualized Return (CAGR):</strong>
      (Final / Initial)<sup>1 / Years</sup> - 1
    </li>

    <li>
      <strong>Volatility:</strong>
      Annualized standard deviation of weekly returns
    </li>

    <li>
      <strong>Sharpe Ratio:</strong>
      Annualized Return ÷ Volatility
    </li>

    <li>
      <strong>Max Drawdown:</strong>
      Minimum peak-to-trough portfolio decline
    </li>
  </ul>
</div>

      <!-- RIGHT: Results table -->
      <div class="card">
        <div class="results-header">
          <h2>Results Summary</h2>

          <table>
            <thead>
              <tr>
                <th>Metric</th>
                <th>Strategy</th>
                <th>Benchmark</th>
                <th>Nasdaq 100 (QQQ)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="metric">Total Return</td>
                <td><span id="s_total_return">—</span></td>
                <td><span id="b_total_return">—</span></td>
                <td><span id="n_total_return">—</span></td>
              </tr>
              <tr>
                <td class="metric">Annualized Return</td>
                <td><span id="s_annualized_return">—</span></td>
                <td><span id="b_annualized_return">—</span></td>
                <td><span id="n_annualized_return">—</span></td>
              </tr>
              <tr>
                <td class="metric">Volatility</td>
                <td><span id="s_volatility">—</span></td>
                <td><span id="b_volatility">—</span></td>
                <td><span id="n_volatility">—</span></td>
              </tr>
              <tr>
                <td class="metric">Sharpe</td>
                <td><span id="s_sharpe">—</span></td>
                <td><span id="b_sharpe">—</span></td>
                <td><span id="n_sharpe">—</span></td>
              </tr>
              <tr>
                <td class="metric">Max Drawdown</td>
                <td><span id="s_max_drawdown">—</span></td>
                <td><span id="b_max_drawdown">—</span></td>
                <td><span id="n_max_drawdown">—</span></td>
              </tr>
            </tbody>
          </table>

          <p class="note" id="metrics_period">Loading metrics...</p>
          <p class="note">Source: Yahoo Finance API</p>
        </div>

        <!-- Chart -->
        <div class="chart-inner chart-card">
          <div class="chart-header">
            <h2>Backtest Visualization</h2>
            <p class="chart-sub">
              Interactive equity curves for Strategy vs Benchmark vs Nasdaq 100 (QQQ).
            </p>
          </div>

          <!-- Cache-bust to avoid GitHub Pages/iframe staleness -->
          <iframe src="./moving_average_backtest.html?v=11" loading="lazy"></iframe>
        </div>
      </div>
    </section>

    <!-- Metrics loader -->
    <script>
      (async function loadMetrics() {
        function $(id) { return document.getElementById(id); }
        function setText(id, value) { const el = $(id); if (el) el.textContent = value; }

        function asNum(x) {
          const n = Number(x);
          return Number.isFinite(n) ? n : null;
        }

        // For CAGR/volatility/drawdown stored as decimals (0.23 => 23%)
        function fmtPctDecimal(x) {
          const n = asNum(x);
          if (n === null) return "—";
          return `${(n * 100).toFixed(2)}%`;
        }

        // For total return stored as MULTIPLE (7.20 => 720%)
        function fmtTotalReturnMultiple(x) {
          const n = asNum(x);
          if (n === null) return "—";
          return `${(n * 100).toFixed(2)}%`;
        }

        function fmtNum(x) {
          const n = asNum(x);
          if (n === null) return "—";
          return n.toFixed(2);
        }

        function fill(prefix, obj) {
          if (!obj) return;

          // total_return is a multiple in your current metrics.json (e.g., 7.20)
          setText(`${prefix}_total_return`, fmtTotalReturnMultiple(obj.total_return));

          // annualized return might be stored as cagr (preferred) or annualized_return
          const ann = (obj.cagr !== undefined) ? obj.cagr : obj.annualized_return;
          setText(`${prefix}_annualized_return`, fmtPctDecimal(ann));

          setText(`${prefix}_volatility`, fmtPctDecimal(obj.volatility));
          setText(`${prefix}_sharpe`, fmtNum(obj.sharpe));
          setText(`${prefix}_max_drawdown`, fmtPctDecimal(obj.max_drawdown));
        }

        try {
          // cache-bust JSON (GitHub Pages/CDN can be sticky)
          const url = `./metrics.json?v=${Date.now()}`;
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error(`metrics.json fetch failed: ${res.status}`);

          const data = await res.json();

          // period text (supports either schema)
          if (data.period?.start && data.period?.end) {
            setText("metrics_period", `Metrics computed from ${data.period.start} to ${data.period.end}.`);
          } else if (data.period_start && data.period_end) {
            setText("metrics_period", `Metrics computed from ${data.period_start} to ${data.period_end}.`);
          } else {
            setText("metrics_period", "Metrics loaded.");
          }

          // support BOTH schemas:
          // A) { metrics: { strategy, benchmark, nasdaq } }
          // B) { strategy, benchmark, nasdaq100/nasdaq_100/qqq }
          const strategy = data.metrics?.strategy || data.strategy;
          const benchmark = data.metrics?.benchmark || data.benchmark;
          const nasdaq   = data.metrics?.nasdaq   || data.nasdaq100 || data.nasdaq_100 || data.qqq || data.nasdaq;

          fill("s", strategy);
          fill("b", benchmark);
          fill("n", nasdaq);

          // If something is missing, fail loudly in console (helps debugging)
          if (!strategy || !benchmark || !nasdaq) {
            console.warn("One or more metrics sections missing:", { strategy, benchmark, nasdaq });
          }

        } catch (err) {
          console.error(err);
          setText("metrics_period", "Metrics failed to load.");
        }
      })();
    </script>

  </div>
</body>
</html>
